## 为什么会需要消息队列（MQ）？

- 主要原因是由于高并发环境下，由于来不及同步处理，请求往往会发生堵塞，比如所，大量的insert，update之类的请求同时到达mysql，直接导致无数的行锁表所，甚至最后请求会堆积过多， 从而触发too many connections错误。通过使用消息队列，从而缓解系统的压力。

- 说了这么多，其实最核心的是：解耦、异步、消峰

## 消息队列有什么优缺点？

优点上面已经说了，就是在特殊场景下尤其对应的好处，解耦，异步，削峰。

- 缺点有以下几个。
- 系统可用性降低
- 系统引入的外部依赖越多，越容易挂掉。本来你就是A系统调用BCD三个系统的接口就好了，人ABCD四个系统好好地，没啥问题，你偏加个MQ进来，玩意MQ挂掉咋办，MQ一挂，整套系统崩溃了，你不就完了？如何保证消息队列的高可用，可以在后面将讲解集群形式。
- 系统复杂度搞
- 硬生生的加个MQ进来，你怎么保证没有重复消费？怎么处理消息丢失的情况？怎么保证消息传递的顺序性？头大头大，问题一大堆，痛苦不已。
- 一致性问题。
- A系统处理完了直接返回成功了，人都以为你这个请求就成功了；但是问题是，要是BCD三个系统哪里，BD两个系统写库成功了，结果C系统写库失败，咋整？你这个数据就不一致了。
- 所以消息队列是一种非常复杂的数据架构，拟引入他有很多好处，但是也得针对它带来的坏处做各种额外的技术方案和架构来规避掉，做好之后，你会发现，妈呀，系统复杂度提升了一个数量级，也许是复杂了十倍，但是在关键时刻，该用，还得用。

## 消息中间件

ActiveMQ：中小型企业

比较弱性能比较适中

上万左右消息量级



Kafka

大数据流形式处理

千万级

不支持事务

适合大数据互联网架构收集事务

ZK

RocketMq

高可用 高吞吐量  适合大规模的分布式系统 

商业版本:消息可靠性以及事务性能优化



RabbitMQ

Erlang语言开发消息队列

AMQP  

面向消息 对垒 路由 点对点  发布订阅 可靠性 安全性 