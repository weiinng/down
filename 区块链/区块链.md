机器学习

首先程序没有思维，人类在用指定的逻辑合算法使得机器在指定范围内运行，就是机器学习。

极客 <https://baike.baidu.com/item/%E6%9E%81%E5%AE%A2/3683808?fr=aladdin> 



2016年夏天我参加了加勒比海内克岛（Necker Island）的区块链三 天恳谈会。著名嬉皮士企业家理查德·布兰森（Richard Branson）邀请了 十几个国家不同领域的人士在海浪和阳光沙滩的环抱中讨论区块链的应 用。没错，这种时空穿越真是让人惊喜。这些来自政府、法院、情报系 统、互联网、艺术、航天和环保机构的30多位彼此陌生的人士组织了十 几场不同主题的讨论会，讨论抓捕逃犯、防范洗钱、保护艺术产权、确认交易真实性、防止贪污腐败、社会选举、地震救援和濒危生物的保护 等，在感受到这些领域鲜活的具体成就的同时，也在体会一个共同的应 用逻辑：这都是建立在大数据分析基础上自发组织、彼此交叉合作的成 果，而且没有一个权威机构或企业在组织这个系统和过程。  

区块链：全新的信任协议

我和许多同道中人更欣赏“公信链”

如同互联网的TCP/IP协议一样，如果你不执迷于解码和编码，你就可以发现区块链技术远比浏览互联网和电商交易有更为广泛和深刻的应用。许多人将区块链视为一个巨大的分布式记账体系，所有人参与记账查账，无人有能力篡改。这很有道理，但区块链显然要远远超过记账的认证功能。

区块链说到底更是一种观念，用技术设计取代权威控制和情感信任，以此建立一种网络结构，所有人都可以参与成为无数节点之一，进行认证、确权、交易、追溯和调整等一系列动作，它公开透明，成本低、速度快、分布广，没有权威可以篡改伪造和取缔记录。

本思聪

   

# 推荐序二    这是一本区块链普及读物

​    

我们认识并改造这个世界的方式一直在改变，而技术是其中最大的推动力。

建议读者尝试去金融博物馆看看比特币挖矿的机器，了解一下哈希密码为何难以破解，以及关注一些最新的区块链动态以跟上时代的脉搏。

\1. 可以无限增加的巨型账本——每个区块可以视作这个账本的一页，每增加一个区块，账本就多了一页，这一页中可能会包含一条或多条记录信息；

​    

\2. 加密且有顺序的账本——账目信息会被打包成一个区块并加密，同时盖上时间戳，一个个区块按时间戳顺序链接形成一个总账本；

​    

\3. 去中心化的账本——由网内用户共同维护的，它是去中心化的。

​    

区块链是人类的记账历史走到现在，科技给我们的最新的选择，它是账本演变史上最新的一个高可行性的形态。我们来更简单地阐释一下价值转移这个概念，将某一部分价值从A地址转移到B地址，那么需要A地址精确地减少了这部分价值，而B地址精确地增加了这部分价值。价值转移涉及A和B这两个独立的参与者，那么这个操作就必须同时得到A和B的认可，而且，结果还不能受到A和B任何一方的操纵，目前的互联网协议是不支持价值转移功能的，所以，目前的价值转移往往不是直接传输，而是由一个中心化的第三方来做背书。

区块链技术就这样应运而生了，它可以在没有第三方信用背书的情况下，在一个开放式的平台上进行远距离的安全支付。区块链跨越多个遍布全球各地的节点，保存所有交易的历史记录。

​    

而且，网络中所有授权的参与者都保存着一份完全相同的账本，一旦对账本进行修改，全部副本数据也将在几分钟甚至几秒钟内全部修改完毕。分布式账本中的每一笔交易都有一个独一无二的时间戳，这样可以防止重复支付的产生。

互联网中只有时间戳不可逆

私有可逆，如果连接共有网络就完全不可逆

## 信用成本：你能记住多少人的脸

​    

你有想过一个问题吗——你能记住多少人的脸？你有听过“e租宝跑路”事件吗？这些都会引入一个问题：信用共识。相信一个人需要什么成本？一旦公信力机构出现了问题，信任又将何处安放？

​    

有一个人类学家在研究部落的时候发现，每一个部落都被控制在150人左右的范围，因为人再多一些的话，大家就记不住彼此了，记不住脸就感受不到亲近，感受不到亲近就培养不了信任，没有信任，部落之间的战斗和争端就永远不会停止。

在部落时代，或许只是因为在人群中多看了一眼，就会被打成熊猫眼，而到如今的互联网时代，为什么大家愿意去相信远在千里之外的一个卖衣服的商家，并且给他付款呢？因为在这个交易过程图1–14 部落时代的信任危机

​    

在部落时代，或许只是因为在人群中多看了一眼，就会被打成熊猫眼，而到如今的互联网时代，为什么大家愿意去相信远在千里之外的一个卖衣服的商家，并且给他付款呢？因为在这个交易过程中，我们把信任托付给了国家机构或者大型企业，我们和卖衣服的人之间仍然是不信任的，但是，由于国家或大型企业的背书，我们愿意让其做个见证，这是一种比较常用的增加互信的方式。



它起源于下面的问题：你凭什么相信一个陌生人？别人凭什么相信你？区块链用算法证明机制来保证这份信任。借助它，整个系统中的所有节点能够在信任的环境下自动安全地交换数据。与费时费钱的其他工具技术相比，它能实时自动撮合、强制执行，而且成本很低。



1. 区块链是分布式的，区块链公信力在网络上会有许多独立的节点，每一节点都有一份备份信息。每个有授权的人都可以从任意一个节点下载全部的信息，同时，区块链公信力网络也是不可篡改的，任何节点企图更改信息都会被其他节点发现，而更改的节点不会被确认，就会立刻丧失公信力。

2. 在区块链公信力模型中，区块链不制定政策，它只是一个公证人的角色，是政府建立和执行政策的工具。区块链的作用是帮助政府更快速和准确地让政策被全民所接受与认可，同时，因为区块链是一个不变的、可以被复制的数据库，政府的政策就变得公开和透明。

   从信任的角度来看，区块链实际上是用基于共识的数学方法，在机器之间建立信任并完成信用创造。基于这样的特点，其对公信力的提升也有着开创性的意义。《经济学人》杂志这样写道：区块链是一台创造信任的机器，可以说区块链最核心的问题就是解决信用共识的问题。



如果某一个节点更改了本身的信息，其他节点信息没有同步，这样就没有人承认他的这条虚假信息

当你把全世界的百分51的节点同步之后才可能实现被认可 但是还是不肯能的

------

 

## 技术创新：从比特币到区块链

​    

我们都知道，区块链是比特币的底层技术，可以说它是一种分布式数据存储模式，也可以说它是储存加密货币（例如比特币）的交易记录的公共账本。它的记录是加密的，被所有运行这个软件的机器所持有。

​    

要说区块链就必然会讲到数字货币，毕竟区块链是为了满足比特币独特的需求才被创造出来的。而比特币则源于一个神秘的人物——中本聪。2008年，中本聪发表了一篇论文《比特币：一种点对点的电子现金系统》，这篇论文堪称区块链技术和加密数字货币发明的基础。



比特币完全禁止：第三方中介  更改记录  黑客攻击    双重支付    

在这篇论文中提出了比特币的几个基本原则：

​    

\1. 一个纯粹的点对点电子现金系统，使在线支付能够直接由一方发起并支付给另一人，中间不需要通过任何金融机构。

​    

\2. 不需要授信的第三方支持就能防止双重支付，点对点的网络环境是解决双重支付的一种方案。

​    

\3. 对全部交易加上时间戳，并将他们并入一个不断延展的基于哈希算法的工作量证明的链条作为交易记录。除非重新完成全部的工作量证明，形成的交易记录将不可更改。

​    

\4. 最长的链条不仅将作为被观察的事件序列的证明，而且被视为来自CPU（中央处理器）的计算能力最大的池。只要大多数CPU的计算能力不被合作攻击的节点所控制，那么就会生成最长的、长度超过攻击者的链条。



\5. 这个系统本身需要的基础设施非常少，节点尽最大努力在全网传播信息即可，节点可以随时离开和重新加入网络，并将最长的工作量证明作为该节点离线期间发生的交易的证明。

​    

看完上述的观点和逻辑，你是不是已经相信这样的理论是可行的，无须中心化的干预或者参与，只要让网络扮演信用中介的角色，就能实现有效的点对点交易。依照这样的理论，第一个比特币交易系统产生了，第一个区块（“创世区块”）产生了，第一个比特币支付的案例产生了，至今，比特币已经安稳运行了8年，没有出现过技术上的严重失误。











实际上，作为比特币的底层技术，区块链与比特币不是简单的“父子”关系，区块链也不是比特币的意外产物。区块链的产生是伴随着比特币而出现的，区块链体现了比特币的可供性，这种载体提供了一种更为广阔的交互可能性。

​    

[[1\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0007_split_001.html#note1) 区块链技术在区域性股权市场的五大应用场景[EB/OL]. (2017–03–16)[2017–05–18]. http://www.51jrit.com/news/detail/6246.

​    

[[2\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0007_split_003.html#note2) e租宝背后的互联网金融之殇[EB/OL]. [2017–05–18]. http://weixin.niurenqushi.com/article/2016–03–07/4176154.html.

​    

[[3\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0007_split_003.html#note3) 蔡维德，罗佳。区块链所带来的公信力革命——以区块链对保险行业的影响为例[EB/OL]. (2015–12–15) [2017–05–18]. http://www.civillaw.com.cn/zt/t/?id=29937.

# 知乎博文

于是，我意识到，百度上的概念以及学术杂志的解释或许不能让他们满足，于是我开始沉迷于博客、知乎，想看看大家都是如何解释区块链这个晦涩又抽象的概念。在这中间，有两篇文章对我的影响很深，一篇是知乎上的一个热门话题“如何向弱智室友解释区块链”，另一篇是博客频道用户“张童鞋”的一篇名为“区块链上的共识机制”的文章，在下面的阐述中我也部分引用了他们的观点并尝试了他们讲故事的方式。





## 讲一个故事，什么是区块链

​    

### 区块链与骑自行车的人

​    

2016年，包括摩根大通、花旗集团、高盛集团、纳斯达克等在内的金融巨头，都表达了对区块链技术的热衷。这些巨头们热衷的区块链技术，又被称为分布式账本，那么分布式账本究竟是什么呢？我们先从另外一件事说起。

​    

在纳斯达克成立之前，人们用自行车驮着装满债券的包，在华尔街骑来骑去，目的就是尽快完成清算。后来业务越来越多，自行车就忙不过来了。20世纪60年代，华尔街每周只交易4天，每天4个小时，就是为了能让清算速度跟上交易量。



这样发展下来，大家觉得不行啊，自行车肯定跑不过计算机。1971年，有人就开会说，咱们想想办法吧，于是提出了DTC（美国存管信托公司）清算系统。这个系统的办法就是所有的交易都要在系统内进行，包括经纪人也要接入这个系统，现在纳斯达克还在用。

​    

很明显，它的问题只是换了一辆可以踩油门的自行车。我们常常看到一些影视剧里，皇上、一家之主的去世导致整个国家和民族陷入混乱甚至崩溃，根本原因就在于中央集权这种系统是没办法长存的。当交易足够多、经纪人足够多的时候，我们发现，这个系统也有瘫痪甚至崩盘的危险。

​    

图2–2 中心化的DTC清算系统

​    

于是专家们想，自治式、分布式的系统会不会好一点呢？答案是肯定的。区块链就是一个分布式的账本，每个节点都可以显示总账，然后维护总账，而且不能篡改账本，除非你控制了超过51%的节点，但这是不可能的。

​    

再简单一点，假如你们家里有个账本，让你来记账。在以前，就是爸爸妈妈把工资交给你，让你记到账本上——想想还是有点小激动的。中间万一你贪吃，想买点好吃的，可能账本上的记录会少十几块，然后你想买个手机，账本上就少记录几千块。这只是举一个例子，我相信小时候大家都想从爸爸妈妈的口袋里拿点钱来花。

​    

图2–3 中心化的家庭账本

​    

但有了分布式账本后，这些问题就不会有了，因为你在记账，你爸爸也在记账，你妈妈也在记账，他们都能看到总账，你不能改，爸爸妈妈也不能改，这样想买烟抽的爸爸和想贪吃的你都没办法啦。

​    

区块链本质上是一个去中心化的分布式账本，其本身是一系列使用密码学而产生的互相关联的数据块，每一个数据块中包含了多条经比特币的网络交易有效确认的信息。

​    

图2–4分布式家庭账本

​    

### 中心化与去中心化

​    

前面我们说到了区块链的本质是一个去中心化的分布式账本，那么，所谓的中心化又是什么呢？我们首先思考这样一个问题，你要在网上买一本书，交易流程是什么？

​    

第一步：你下单之后把钱打给了支付宝。

​    

第二步：支付宝收款后通知卖家可以发货了。

​    

第三步：卖家收到通知后给你发货。

​    

第四步：你收到货之后很满意，于是确认收货。

​    

第五步：支付宝收到了你的通知并打钱给卖家。

​    

图2–5 中心化的交易流程

​    

我们可以看出，在这个过程中，虽然你是在和卖家交易，但是整个交易都是围绕支付宝展开。因此，如果支付宝系统出了问题，比如天上降下来一块陨石，把支付宝的服务器全砸了，或者由于全球经济危机支付宝倒闭了，无奈的支付宝只好淡然地表示不存在这笔交易，那么这笔交易就会以失败告终，到时候买家卖家就会纠缠不清，双方无法自证。

​    

图2–6 中心节点毁坏会导致交易失败

​    

### 模拟一个区块链小城市

​    

为了说明去中心化的区块链是如何运行的，我们先把整个去中心化的分布式结构简化为一个极端的情况来探究。我们假设有一个去中心化的小城市，在这个城市里有5个可爱活泼的小伙伴，他们互相借钱的时候，是这么干的：

​    

假设B向A借了1块钱，这个时候，城市里的人怎么办呢？A在人群中大喊：“我是A，我借给了B1块钱！”B也在人群中大喊：“我是B，A借给了我1块钱！”

​    

此时城市里的其他人C、D、E都听到了这些消息，他们拿出了手中的小账本并默默记下：“某年某月某日，A借给了B1块钱。”

​    

图2–7 去中心化城市的记账

​    

当我们把一个去中心化的模型极度简化之后，我们就会发现，在这个只有5个人的城市中，已经建立了一个去中心化的系统，这个系统不需要银行，也不需要支付宝。这个模型不需要信任关系，也不需要一个拥有公信力的组织。当分布式结构中的每个人都记账的时候，篡改账本是不可行的。比如B突然不认账了：“我不欠A的1块钱！”这个时候，人民群众C或D或E就会站出来说：“不对，我的账本上明明记录了你在某年某月某日向了A借了1块钱，并且没有查到你还款的记录。”

​    

图2–8 去中心化账本无法篡改

​    

说到这里，你有没有发现一个问题，在这个模型中，所谓的1块钱根本不重要，也没有人在意，“1块钱”已经变成了一个变量，它可以被替换成任何概念，只要大家承认这是一个有价值的东西即可。

​    

比如A在这个城市中大喊一声：“我创造了一个巴拉拉能量！”城市中的其他人都听见了，于是大家纷纷在自己的小本子上记下“某人有一个巴拉拉能量”，大家甚至不用知道巴拉拉能量是什么，A竟然真的有了一个巴拉拉能量。之后呢？A还能干什么呢？A可以再大喊一声：“我给了B一个巴拉拉能量。”

​    

图2–9 巴拉拉能量的流通

​    

只要城市中的B、C、D、E，即城市里的所有人都承认了这个交易，那么这个交易就真的成立了，虽然现实生活中并没有巴拉拉能量。

​    

### 小城市里的几个问题

​    

当然，区块链的世界不会这么简单，它还有其他的规则来相互制约，我们先来解决下面这几个问题：

​    

#### 问题一：凭什么帮你记账？

​    

凭什么你对着天空大喊一声，别人就要帮你记账，别人的时间不要钱吗？别人的小本子不要钱吗？于是，为了让大家都帮我记账，我增加了一条新的规则，我决定给第一个听到我喊话并且将其记录在小本子上的人奖励。奖励机制也很简单，第一个听到我喊话并记录下来的人，可以得到一个巴拉拉能量的奖励。

​    

这个巴拉拉能量不是白给的，是对你劳动的报酬，就像打工可以挣钱一样，你帮我记账，整个系统都会给你报酬。你要做的事情，有这样几点：首先，你要抢在所有人之前听到了我的喊话并记在了自己的小本子上；记录之后，你还要马上告诉整个城市里的人——这句话我记录完了，你们再记录也没有用了，别人就会放弃这笔赚钱的生意；与此同时，你还要做一件事，就是给自己的记录加一个独一无二的编号，然后把记录和编号一起喊出来，于是，下一个人再记录的时候，就会带着这个记录和独一无二的编号继续下去。

​    

图2–10 记账获得奖励

​    

在这条新的规则开始实行之后，一定会有这样一些人，他们为了得到巴拉拉能量，开始屏气监听周围发出的各种声音，只为了能在第一时间记下一条新的记录。

​    

这个时候，对区块链有所了解的读者是不是想到了这样的名词——“比特币挖矿”。没错，这就是比特币挖矿的简单说明。

​    

关于比特币挖矿的话题，知乎用户“玲珑邪僧”的一篇文章举过一个更生动的例子，大致是这样的：单身男士们要找女朋友，“国民岳母”说，我有好多肤白貌美、乖巧可爱的女儿，这样吧，我给你们出一个旷世难题，解出一个就给你们其中一个姑娘的微信号。[[1\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0008_split_003.html#note4n)

​    

于是，单身男士们疯狂竞争，想破脑袋去解这道旷世难题。只要其中一位单身男士解出一道题，就立马得意扬扬地昭告天下，示威全部单身男士，这个姑娘的微信号是我的啦，先到先得，你们放弃吧。其他单身男士虽然已经算到一半了，但是没有办法，速度不够快啊，只好立马去解下一道题。



同时，首个成功破解旷世难题的幸运的单身男士不仅不用付一二十万元的彩礼，被其才华征服的“国民岳母”还会给这位单身男士一笔巨额财产做嫁妆，也就是比特币挖矿中的比特币奖励。



#### 问题二：分叉问题听谁的？

​    

在这一段的论述中，我们引用了知乎用户“汪乐–LaiW3n”的说法。在这个广阔的小城市里，一定还会存在这样的问题，B和C几乎同时记录完了，于是同时向天空大喊了一声，“这个编号89757的巴拉拉能量归我了”。但是，由于这个城市太广阔了，有的人会认为这个编号89757的巴拉拉能量归B，也有的人认为这个编号89757的巴拉拉能量归C，但是编号89757的巴拉拉能量只有一个啊，只有一个人能得到，怎么办呢？一人一半？当然是不可能的，这个时候我们会采用更原始简单的规则来解决，谁长听谁的。

​    

在不加任何限制条件的情况下，这件事件会发展成这样：一部分人认为这句话是B说的，在听到这句话之后开始记账，之后他们所做的所有事情都是基于B有了编号89757的巴拉拉能量这个事实，并且随着这个信息一次次地传下去，这条信息链会越来越长；而另外一群认为C先说这句话的人，也会按照这样的趋势发展。

我们以比特币为例，中本聪在《比特币白皮书》第五小节中是这样说的，运行比特币网络的步骤如下：[[2\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0008_split_003.html#note5n)

​    

\1. 新的交易向全网进行广播；

​    

\2. 每一个节点都将收到的交易信息纳入一个区块中；

​    

\3. 每个节点都尝试在自己的区块中找到一个具有足够难度的工作量证明；

​    

\4. 当一个节点找到了一个工作量证明，它就向全网进行广播；

​    

\5. 当且仅当包含在该区块中的所有交易都是有效的且之前未存在过的，其他节点才认同该区块的有效性；

​    

\6. 其他节点表示他们接受该区块，而接受的方法则是跟随在该区块的末尾，制造新的区块以延长该链条，并将该区块的随机散列值视为新区块的随机散列值。



挖矿就算 通过算法匹配到与块区哈希对应 就达到解密效果 如果解密成功  这个块区内的资源就算你的





区块链基础架构分为6层，包括数据层、网络层、共识层、激励层、合约层、应用层。每层分别完成一项核心功能，各层之间互相配合，实现一个去中心化的信任机制。





#### 一、数据层

​    

数据层主要描述区块链技术的物理形式。区块链系统设计的技术人员们首先建立的一个起始节点是“创世区块”，之后在同样规则下创建的规格相同的区块通过一个链式的结构依次相连组成一条主链条。随着运行时间越来越长，新的区块通过验证后不断被添加到主链上，主链也会不断地延长。





每个区块中也包含了许多技术，比如时间戳技术，它可以确保每一个区块按时间顺序相连接；再比如哈希函数，它能够确保交易信息不被篡改。

​    

#### 二、网络层

​    

网络层的主要目的是实现区块链网络中节点之间的信息交流。区块链网络本质上是一个P2P（点对点）网络。每一个节点既接收信息，也产生信息。节点之间通过维护一个共同的区块链来保持通信。[[13\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0008_split_003.html#note16n)

​    

区块链的网络中，每一个节点都可以创造新的区块，在新区块被创造后会以广播的形式通知其他节点，其他节点会对这个区块进行验证，当全区块链网络中超过51%的用户验证通过后，这个新区块就可以被添加到主链上了。图2–72 区块链的网络层

​    

#### 三、共识层

​    

共识层能让高度分散的节点在去中心化的系统中高效地针对区块数据的有效性达成共识。区块链中比较常用的共识机制主要有工作量证明、权益证明和股份授权证明三种，我们在下面的章节中会重点讲解。

​    

#### 四、激励层

​    

激励层的主要功能是提供一定的激励措施，鼓励节点参与区块链的安全验证工作。我们以比特币为例，它的奖励机制有两种。在比特币总量达到2 100万枚之前，奖励机制有两种，新区块产生后系统奖励的比特币和每笔交易扣除的比特币（手续费）。而当比特币总量达到2 100万时，新产生的区块将不再生成比特币，这时奖励机制主要是每笔交易扣除的手续费。

​    

图2–73 区块链的激励层

​    

#### 五、合约层

​    

合约层主要是指各种脚本代码、算法机制以及智能合约等。我们以比特币为例，比特币是一种可编程的货币，合约层封装的脚本中规定了比特币的交易方式和过程中涉及的种种细节。

​    

#### 六、应用层

​    

应用层封装了区块链的各种应用场景和案例，比如基于区块链的跨境支付平台OKLink，以及在“应用篇”中我们将讲到的五花八门的应用。

​    

### 区块链的基本类型

​    

#### 一、公有链

​    

公有链是指全世界任何人都可读取、任何人都能发送交易且交易能获得有效确认，任何人都能参与共识过程的区块链——共识过程决定哪个区块可被添加到区块链中，同时明确当前状态。[[14\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0008_split_003.html#note17n)

​    

图2–74区块链的公有链

​    

公有链有如下几个特点：

​    

\1. 保护用户免受开发者的影响

​    

在公有链中程序开发者无权干涉用户，区块链可以保护其用户。

​    

\2. 访问门槛低

​    

任何人都可以访问，只要有一台能够联网的计算机就能够满足基本的访问条件。

​    

\3. 所有数据默认公开

​    

公有链中的每个参与者可以看到整个分布式账本中的所有交易记录。

​    

#### 二、私有链

​    

私有链是指其写入权限仅在一个组织手里的区块链，目的是对读取权限或者对外开放权限进行限制。

​    

图2–75 区块链的私有链

​    

私有链有如下几个特点：

​    

\1. 交易速度非常快

​    

私有链中少量的节点具有很高的信任度，并不需要每个节点都来验证一个交易。因此，私有链的交易速度比公有链快很多。

​    

2.为隐私提供更好的保障

​    

私有链的数据不会被公开，不能被拥有网络连接的所有人获得。

​    

3.交易成本大幅降低甚至为零

​    

私有链上可以进行完全免费或者至少说是非常廉价的交易。如果一个实体机构控制和处理所有的交易，它就不再需要为工作收取费用。

​    

4.有助于保护其基本的产品不被破坏

​    

银行和传统的金融机构使用私有链可以保证它们的既有利益，以至原有的生态体系不被破坏。

​    

#### 三、联盟链

​    

联盟链是指其共识过程受到预选节点控制的区块链。例如，对由15个金融机构组成的共同体而言，每个机构都运行着一个节点，为了使每个区块生效需要获得其中半数以上也就是8家机构的确认。区块链可能会允许每个人读取，也可能会受限于参与者走混合路线。[[15\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0008_split_003.html#note18n)

​    

图2–76 区块链的联盟链

​    

联盟链可以视为“部分去中心化”，区块链项目R3 CEV就可以认为是联盟链的一种形态。

​    

#### 四、其他的说法

​    

我们再来说说区块链分类中的其他几种说法——许可链、混合链和复杂链。

​    

许可链是指每个节点都需要许可才能加入的区块链系统，私有链和联盟链都属于许可链。随着区块链技术的日益发展，区块链的技术架构不再简单地划分为私有链和公有链，它们之间的界限越来越模糊，于是复杂链和混合链的概念就逐渐被人提出来了。

​    

### 区块链的发展脉络

​    

根据区块链科学研究所创始人梅兰妮·斯万（Melanie Swan）的观点，区块链技术发展分三个阶段或领域：区块链1.0、区块链2.0和区块链3.0。[[16\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0008_split_003.html#note19n)

​    

区块链1.0：以比特币为代表的可编程货币。它更多是指数字货币领域的创新，如货币转移、兑付和支付系统等。

​    

区块链2.0：基于区块链的可编程金融。它更多涉及一些合约方面的创新，特别是商业合同以及交易方面的创新，比如股票、证券、期货、贷款、清算结算、所谓的智能合约等。

​    

区块链3.0：区块链在其他行业的应用。它更多地对应人类组织形态的变革，包括健康、科学、文化和基于区块链的司法、投票等。

​    

图2–77 区块链的发展脉络

​    

### 区块链的共识机制

​    

我们在了解共识机制之前，先来看两个古老的引入问题，类两军问题和拜占庭将军问题。

​    

#### 问题一：类两军问题

​    

说到这个问题，网络上广为流传的解释如下：

​    

有两个相距很远的军队要传递信息，蓝军派遣一个信使去跟红军说：“有本事把意大利炮拿出来！”红军收到信息后又派了一个信使去跟蓝军说：“收到指令！”然后蓝军又派一个信使去跟红军说：“知道你收到指令了！”然后红军又派一个信使去跟蓝军说：“知道你知道我收到指令了！”然后蓝军又派一个信使去和红军说：“知道你知道我知道你收到指令了！”然后就没完没了了。

​    

图2–78 类两军问题

​    

#### 问题二：拜占庭将军问题

​    

拜占庭将军问题是一个很古老的问题，具体阐述如下：

​    

拜占庭罗马帝国在军事行动中，采取将军投票的策略来决定是进攻还是撤退，也就是说如果多数人决定进攻，就冲上去。但是军队中如果有奸细（比如将军已经反水故意乱投票，或者传令官叛变擅自修改军令），那怎么保证最后投票的结果真实反映了忠诚的将军的意愿呢？[[17\]](ms-local-stream://EpubReader_75C9AB802FC1415191CE00BBE33CB629/Content/text/part0008_split_003.html#note20n)

​    

我们详细说明一下这个问题。

​    

在很久很久以前，有一个强大的帝国叫作拜占庭，它的军队非常强大，周围有10个小国家，饱受拜占庭帝国的欺压，但是，必须同一时间有6个以上的国家进攻才有可能打败拜占庭帝国，否则就一定会战败。

​    

这个时候，问题就出现了，古时候军队之间的通信完全依赖于人，如果一个国家的军队里有奸细，无论是下令的将军还是传信的通信兵，都可能会使得另外9个国家收到假消息，从而造成作战失败。那么，如果你是其中一个小国的国王，你该如何判断一定会有另外5个以上的国家与你并肩作战呢？毕竟一个不小心，你就亡国了。

​    

图2–79 拜占庭将军问题

​    

正是由于以上这些问题，我们需要达成共识。区块链上的共识机制有多种，没有一种共识机制是完美无缺的，同时也意味着没有一种共识机制是适合所有应用场景的。这里我们引用了“张童鞋”的一篇文章，并获得了他的授权。我们选取了其中比较有特点的9种共识机制做一个简单介绍，常见的共识机制主要有工作量证明、权益证明和股份授权证明三种。

​    

#### 一、工作量证明

​    

工作量证明（Proof of Work，简称PoW）通常只能从结果证明，因为监测工作过程通常是烦琐且低效的。

​    

比特币在区块的生成过程中使用了PoW机制，一个符合要求的区块哈希值由N个前导零构成，零的个数取决于网络的难度值。要得到合理的区块哈希值需要经过大量的尝试计算，计算时间取决于机器的哈希运算速度。当某个节点提供出一个合理的区块哈希值，说明该节点确实经过了大量的尝试计算，当然，这并不能得出计算次数的绝对值，因为寻找合理的哈希值是一个概率事件。当节点拥有占全网n%的算力时，该节点即有n%的概率找到区块哈希值。

​    

PoW依赖机器进行数学运算来获取记账权，资源消耗大、共识机制高、可监管性弱，同时每次达成共识需要全网共同参与运算，性能效率比较低，容错性方面允许全网50%节点出错。

​    

PoW的优点：完全去中心化，节点自由进出。

​    

PoW的缺点：目前比特币已经吸引全球大部分的算力，其他再使用PoW共识机制的区块链应用很难获得相同的算力来保障自身的安全；挖矿造成大量的资源浪费；共识达成的周期较长。

​    

使用PoW的项目有：比特币、以太坊前三个阶段——Frontier（前沿）、Homestead（家园）、Metropolis（大都会）。以太坊的第4个阶段，即Serenity（宁静），将采用权益证明机制。

​    

#### 二、权益证明

​    

权益证明（Proof of Stake，简称PoS）由“Quantum Mechanic”2011年在比特币论坛讲座上首先提出，后经Peercoin（点点币）和NXT（未来币）以不同思路实现。

​    

PoS的主要理念是节点记账权的获得难度与节点持有的权益成反比，相比PoW，其在一定程度上减少了数学运算带来的资源消耗，性能也得到了相应的提升，但依然是基于哈希运算，竞争获取记账权的方式，可监管性弱。该共识机制的容错性和PoW相同。它是PoW的一种升级，根据每个节点所占代币的比例和时间，等比例地降低挖矿难度，从而加快找到随机数的速度。

​    

在PoW中，一个用户可能拿1 000美元来购买计算机，并加入网络来挖矿以此产生新区块，从而得到奖励。而在PoS中，用户可以拿1 000美元购买等价的代币，并把这些代币当作押金放入PoS机制中，这样用户就有机会产生新区块而得到奖励。

​    

总体而言，这个系统中存在一个持币人的集合，他们把手中的代币放入PoS机制中，这样他们就变成验证者。比如对区块链最前面的一个区块而言，PoS算法在验证者中随机选取一个（选择验证者的权重依据他们投入的代币量，比如一个投入押金为10 000代币的验证者被选择的概率是一个投入1 000代币验证者的10倍），给他权利产生下一个区块。如果在一定时间内，这个验证者没有产生一个区块，则选出第二个验证者代替产生新区块。与PoW一样，PoS以最长的链为准。

​    

图2–80 PoS算法随机选取

​    

随着规模经济（指扩大生产规模引起经济效益增加的现象）的消失，中心化所带来的风险减小了。价值1 000万美元的代币带来的回报不多不少，是价值100万美元代币的10倍，不会有人因为负担得起大规模生产工具而得到不成比例的额外回报。

​    

PoS的优点：在一定程度上缩短了共识达成的时间；不再需要大量消耗能源去挖矿。

​    

PoS缺点：还是需要挖矿，本质上没有解决商业应用的痛点；所有的确认都只是一个概率上的表达，而不是一个确定性的事情，理论上有可能存在其他攻击影响，例如，以太坊的DAO攻击事件造成以太坊硬分叉，而ETC随之出现，事实上证明了此次硬分叉的失败。

​    

#### 三、股份授权证明

​    

BitShares（比特股）社区首先提出了股份授权证明（简称DPoS）机制，它与PoS的主要区别在于节点选举若干代理人，由代理人验证和记账，但其合规监管、性能、资源消耗和容错性与PoS相似。类似于董事会投票，持币者投出一定数量的节点，进行代理验证和记账。

​    

DPoS的工作原理如下：每个股东按其持股比例拥有相应的影响力，51%股东投票的结果将是不可逆且有约束力的，其挑战是通过及时而高效的方法达到“51%批准”。为了达到这个目标，每个股东可以将其投票权授予一名代表。获票数最多的前100位代表按既定时间表轮流产生区块。每位代表分配到一个时间段来生产区块。

​    

图2–81 DPoS工作原理

​    

所有的代表将收到等同于一个平均水平的区块所含交易费的10%作为报酬。如果一个平均水平的区块用100股作为交易费，一位代表将获得一股作为报酬。

​    

网络延迟有可能使某些代表没能及时广播他们的区块，而这将导致区块链分叉。然而，这不太可能发生，因为制造该区块的代表可以与制造该区块前后的区块的代表建立直接连接。建立这种与你之后的代表（也许也包括其后的那名代表）的直接连接是为了确保你能得到报酬。

​    

DPoS的投票模式可以每30秒产生一个新区块，并且在正常的网络条件下，区块链分叉的可能性极其小，即使发生也可以在几分钟内得到解决。执行该模式的基本步骤如下：

​    

\1. 成为代表。成为一位代表，你必须在网络上注册你的公钥，并获得一个32位的特有标识符。该标识符会被每笔交易数据的“头部”引用。

​    

\2. 授权投票。每个钱包有一个参数设置窗口，在该窗口里用户可以选择一位或更多的代表，并将其分级。一经设定，用户所做的每笔交易将把选票从“输入代表”转移至“输出代表”。一般情况下，用户不会创建专门以投票为目的的交易，因为那将耗费他们一笔交易费。但在紧急情况下，某些用户可能觉得通过支付费用这一更积极的方式来改变他们的投票是值得的。

​    

\3. 保持代表诚实。每个钱包将显示一个状态指示器，让用户知道他们的代表表现如何。如果他们错过了太多的区块，那么系统将会推荐用户更换一位新的代表。如果任何代表被发现签发了一个无效的区块，那么所有标准钱包将在每个钱包进行更多交易前要求选出一位新代表。

​    

\4. 抵抗攻击。在抵抗攻击上，前100位代表所获得的权力是相同的，即每位代表都有一项平等的投票权，因此，无法通过获得超过1%的选票而将权力集中到单一代表上。由于只有100位代表，不难想象一个攻击者可以对每位轮到其生产区块的代表依次进行拒绝服务攻击。幸运的是，由于每位代表的标识是其公钥而非IP地址，这种特定攻击的威胁很容易被减轻。这将使确定DDoS（分布式拒绝服务）攻击目标更为困难。而代表之间的潜在连接将使妨碍他们生产区块变得更为困难。

​    

图2–82 DPoS的投票模式

​    

DPoS的优点：大幅缩小参与验证和记账节点的数量，可以达到秒级的共识验证。

​    

DPoS的缺点：整个共识机制还是依赖于代币，而很多商业应用是不需要代币的。

​    

#### 四、投注共识

​    

投注共识是以太坊下一代的共识机制Casper（鬼马小精灵）引入的一个全新概念，属于PoS。Casper的共识是按区块达成的，而不是像PoS那样按链达成。

​    

为了防止验证人在不同的世界中提供不同的投注，我们还有一个简单严格的条款：如果你两次的投注序号一样，或者说你提交了一个无法让Casper依照合约处理的投注，你将失去所有保证金。从这一点我们可以看出，Casper与传统的PoS不同的是，Casper有惩罚机制，这样非法节点通过恶意攻击网络不仅得不到交易费，而且还面临着保证金被没收的风险。

​    

Casper协议下的验证人需要完成出块和投注两个活动。具体如下：

​    

出块是一个独立于其他所有事件而发生的过程，验证人收集交易，当轮到他们的出块时间时，他们就制造一个区块，并签名，然后发送到网络上。投注的过程更为复杂一些，目前Casper默认的验证人策略被设计为模仿传统的拜占庭容错共识：观察其他的验证人如何投注，取33%处的值，向0或者1进一步移动。

​    

而客户端确认当前状态的过程是这样的：一开始先下载所有的区块和投注，然后用上面的算法来形成自己的意见，但是不公布意见；它只要简单地按顺序在每个高度进行观察，如果一个区块的概率高于0.5就处理它，否则就跳过它。在处理所有的区块之后所得到的状态就可以显示为区块链的“当前状态”。客户端还可以给出对于“最终确定”的主观看法：如果高度k之前的每个区块形成的意见高于99.999%或者低于0.001%，那么客户端就可以认为前k个区块已经最终确定。

​    

#### 五、瑞波共识机制

​    

瑞波共识算法使一组节点能够基于特殊节点列表形成共识。初始特殊节点列表就像一个俱乐部，要接纳一个新成员，必须由该俱乐部51%的会员投票通过。共识遵循这些核心成员的“51%权力”，





























































































































































































































